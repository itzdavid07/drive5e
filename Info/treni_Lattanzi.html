<!DOCTYPE html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lattanzi Treni Prenotazione Biglietti</title>
  <link rel="icon" type="image/x-icon" href="https://toppng.com/uploads/preview/train-11548702629ts2yvv64p1.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      /*background-color: #d9e4ec;*/
      background-image: url('https://thumbs.dreamstime.com/b/train-doodle-seamless-pattern-illustration-style-58120516.jpg');
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      background-color: white;
      padding: 5px;
      border-radius: 25px;
      font-size: 30px;
      color: #eb3528;
      margin-bottom: 20px;
      text-align: center;
    }

    form {
      background: #fff;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      width: 700px;
      text-align: left;
    }

    .passeggero {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #ccc;
    }

    .flex-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .campo {
      flex: 1 1 45%;
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 6px;
      margin-top: 10px;
    }

    input, select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      border-color: #eb3528;
      outline: none;
    }

    button {
      background-color: #eb3528;
      color: black;
      border: none;
      cursor: pointer;
      font-weight: bold;
      padding: 12px 20px;
      margin-top: 10px;
      transition: background 0.3s;
      border-radius: 6px;
    }

    button:hover {
      background-color: #ffffff;
      border: black solid 1px;
    }

    #output {
      margin-top: 20px;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      font-size: 16px;
      line-height: 1.6;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
      width: 700px;
      text-align: left;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .titolo-riepilogo {
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      color: #eb3528;
      margin-bottom: 10px;
      border-bottom: 2px solid #eb3528;
      padding-bottom: 5px;
    }

    #form-controlli {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>

  <h1>Lattanzi Treni - Prenotazione Biglietto</h1>

  <form id="prenotazioneForm" onsubmit="calcolaBiglietto(); return false;">

    <div id="form-controlli" class="flex-row">
      <div class="campo">
        <label for="partenza">Località di partenza</label>
        <select id="partenza" required>
          <option value="">-- Seleziona --</option>
          <option value="Roma">Roma</option>
          <option value="Milano">Milano</option>
          <option value="Napoli">Napoli</option>
          <option value="Torino">Torino</option>
          <option value="Firenze">Firenze</option>
        </select>
      </div>
      <div class="campo">
        <label for="arrivo">Località di arrivo</label>
        <select id="arrivo" required>
          <option value="">-- Seleziona --</option>
          <option value="Roma">Roma</option>
          <option value="Milano">Milano</option>
          <option value="Napoli">Napoli</option>
          <option value="Torino">Torino</option>
          <option value="Firenze">Firenze</option>
        </select>
      </div>
      <div class="campo">
        <label for="classe">Classe</label>
        <select id="classe" required>
          <option value="">-- Seleziona --</option>
          <option value="1">Prima classe</option>
          <option value="2">Seconda classe</option>
        </select>
      </div>
    </div>

    <div id="passeggeriContainer">
      <div class="passeggero">
        <div class="flex-row">
          <div class="campo">
            <label>Nome</label>
            <input class="nome" required placeholder="Nome" />
          </div>
          <div class="campo">
            <label>Cognome</label>
            <input class="cognome" required placeholder="Cognome" />
          </div>
          <div class="campo">
            <label>Data di nascita</label>
            <input class="dataNascita" type="date" required />
          </div>
        </div>
      </div>
    </div>

    <button type="button" onclick="aggiungiPasseggero()">Aggiungi passeggero</button>
    <button type="submit">Calcola prezzo</button>
  </form>

  <div id="output"></div>

  <script>
    const distanze = {
      "Roma": { "Milano": 570, "Napoli": 225, "Torino": 670, "Firenze": 275 },
      "Milano": { "Roma": 570, "Napoli": 770, "Torino": 140, "Firenze": 300 },
      "Napoli": { "Roma": 225, "Milano": 770, "Torino": 860, "Firenze": 470 },
      "Torino": { "Roma": 670, "Milano": 140, "Napoli": 860, "Firenze": 420 },
      "Firenze": { "Roma": 275, "Milano": 300, "Napoli": 470, "Torino": 420 }
    };

    function aggiungiPasseggero() {
      const container = document.getElementById('passeggeriContainer');
      const nuovoPasseggero = document.createElement('div');
      nuovoPasseggero.classList.add('passeggero');
      nuovoPasseggero.innerHTML = `
        <div class="flex-row">
          <div class="campo">
            <label>Nome</label>
            <input class="nome" required placeholder="Nome" />
          </div>
          <div class="campo">
            <label>Cognome</label>
            <input class="cognome" required placeholder="Cognome" />
          </div>
          <div class="campo">
            <label>Data di nascita</label>
            <input class="dataNascita" type="date" required />
          </div>
        </div>  
      `;
      container.appendChild(nuovoPasseggero);
    }

    function calcolaBiglietto() {
      const partenza = document.getElementById('partenza').value;
      const arrivo = document.getElementById('arrivo').value;
      const classe = document.getElementById('classe').value;
      const output = document.getElementById('output');
      output.style.opacity = 0;
      output.innerHTML = "";

      if (partenza === arrivo) {
        output.textContent = "La località di partenza e arrivo devono essere diverse.";
        output.style.opacity = 1;
        return;
      }

      let km = 0;
      if (distanze[partenza] && distanze[partenza][arrivo]) {
        km = distanze[partenza][arrivo];
      } else if (distanze[arrivo] && distanze[arrivo][partenza]) {
        km = distanze[arrivo][partenza];
      } else {
        output.textContent = "Percorso non disponibile.";
        output.style.opacity = 1;
        return;
      }

      const prezzoBaseKm = 0.15;
      let prezzoTotale = 0;

      const passeggeri = document.querySelectorAll('.passeggero');
      let riepilogo = `<div class="titolo-riepilogo">Riepilogo Biglietti</div>`;

      for (let i = 0; i < passeggeri.length; i++) {
        const passeggero = passeggeri[i];
        const nome = passeggero.querySelector('.nome').value.trim();
        const cognome = passeggero.querySelector('.cognome').value.trim();
        const dataNascitaInput = passeggero.querySelector('.dataNascita').value;

        if (!nome || !cognome || !dataNascitaInput) {
          output.textContent = `Compila tutti i campi per il passeggero ${i + 1}.`;
          output.style.opacity = 1;
          return;
        }

        const dataNascita = new Date(dataNascitaInput);
        const oggi = new Date();
        let eta = oggi.getFullYear() - dataNascita.getFullYear();
        const m = oggi.getMonth() - dataNascita.getMonth();
        if (m < 0 || (m === 0 && oggi.getDate() < dataNascita.getDate())) {
          eta--;
        }
        if (isNaN(eta) || eta < 0 || eta > 120) {
          output.textContent = `Età non valida per il passeggero ${i + 1}. Inserisci una data di nascita realistica.`;
          output.style.opacity = 1;
          return;
        }

        let prezzo = km * prezzoBaseKm;
        if (classe === "1") prezzo *= 2;

        let sconto = "Non applicabile";
        if (eta < 18 && eta > 3) {
          sconto = "Sconto Under 18 (-20%)";
          prezzo = prezzo * 0.8;
        } else if (eta > 65) {
          sconto = "Sconto Over 65 (-30%)";
          prezzo = prezzo * 0.7;
        } else if (eta < 3) {
          sconto = "Sconto Bambini (-100%)";
          prezzo = 0;
        }

        prezzoTotale += prezzo;
        prezzo = prezzo.toFixed(2);

        riepilogo += `
          <div style="margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 8px;">
            <strong>Passeggero ${i + 1}</strong><br/>
            Nome: ${nome}<br/>
            Cognome: ${cognome}<br/>
            Età: ${eta} anni<br/>
            Sconto: ${sconto}<br/>
            Prezzo: €${prezzo}<br/>
          </div>
        `;
      }

      riepilogo += `<div style="font-weight: bold; font-size: 18px; text-align: center;">Prezzo totale: €${prezzoTotale.toFixed(2)}</div>`;
      output.innerHTML = riepilogo;
      output.style.opacity = 1;
    }
  </script>

</body>
</html>
